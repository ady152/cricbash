<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CricBash - Dream Team & Packs</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  body {
    margin: 0; padding: 0; font-family: 'Poppins', sans-serif;
    background: #121212; color: #eee;
    display: flex; flex-direction: column; min-height: 100vh;
  }
  header {
    background: #1f1f1f; padding: 1rem;
    display: flex; justify-content: space-between; align-items: center;
  }
  header h1 {
    margin: 0; font-weight: 600; color: #00c853;
  }
  header nav button {
    background: #00c853; border: none; padding: 0.5rem 1rem;
    font-weight: 600; color: #121212; cursor: pointer;
    border-radius: 4px; margin-left: 0.5rem;
    transition: background 0.3s;
  }
  header nav button:hover {
    background: #00e676;
  }
  main {
    flex-grow: 1; padding: 1rem; max-width: 900px; margin: auto;
  }
  section {
    margin-bottom: 2rem;
    background: #212121; border-radius: 8px; padding: 1rem;
  }
  h2 {
    margin-top: 0;
    color: #00e676;
  }
  #statusMsg {
    margin-bottom: 1rem;
    font-weight: 600;
    color: #ffab00;
  }
  .hidden {
    display: none;
  }
  label {
    display: block; margin-bottom: 0.5rem; font-weight: 600;
  }
  input[type="email"], input[type="password"] {
    width: 100%; padding: 0.5rem; margin-bottom: 1rem;
    border-radius: 4px; border: none;
  }
  button.primary {
    background: #00c853; color: #121212; border: none; padding: 0.7rem 1.2rem;
    border-radius: 4px; font-weight: 600; cursor: pointer;
    transition: background 0.3s;
  }
  button.primary:hover {
    background: #00e676;
  }
  button.danger {
    background: #d50000; color: #fff; border: none; padding: 0.4rem 0.8rem;
    border-radius: 4px; font-weight: 600; cursor: pointer;
    margin-left: 1rem;
  }
  button.danger:hover {
    background: #ff1744;
  }
  .flex-row {
    display: flex; flex-wrap: wrap; gap: 1rem;
  }
  .card {
    background: #2c2c2c; border-radius: 6px;
    padding: 1rem; width: 150px;
    box-shadow: 0 0 8px #00c853aa;
    position: relative;
  }
  .card.elite {
    border: 2px solid #00e676;
  }
  .card.legendary {
    border: 2px solid #ff6d00;
  }
  .card.icon {
    border: 2px solid #d50000;
  }
  .card.rare {
    border: 2px solid #2979ff;
  }
  .card.standard {
    border: 1px solid #666;
  }
  .card h3 {
    margin: 0 0 0.5rem 0;
    font-size: 1.1rem;
    color: #00c853;
  }
  .card p {
    margin: 0.2rem 0;
    font-size: 0.9rem;
  }
  .card small {
    color: #aaa;
  }
  .btn-small {
    position: absolute;
    bottom: 6px; right: 6px;
    background: #00c853;
    border: none;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    cursor: pointer;
    color: #121212;
    font-weight: 600;
  }
  #coinsDisplay {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: #00e676;
  }
  #packs button {
    margin-right: 1rem;
  }
  #collection, #dreamTeam {
    min-height: 180px;
  }
  #collection .card, #dreamTeam .card {
    cursor: pointer;
  }
  #collection .card.selected {
    box-shadow: 0 0 12px 3px #00e676;
  }
  #dreamTeam .card.replace-highlight {
    box-shadow: 0 0 15px 4px #d50000;
  }
  footer {
    background: #1f1f1f; color: #555; text-align: center;
    padding: 1rem; font-size: 0.85rem;
  }
</style>
</head>
<body>
<header>
  <h1>CricBash</h1>
  <nav>
    <button id="btnShowLogin">Login / Signup</button>
    <button id="btnLogout" class="hidden">Logout</button>
  </nav>
</header>

<main>
  <div id="statusMsg"></div>

  <section id="authSection">
    <h2>Login or Signup</h2>
    <label for="emailInput">Email</label>
    <input type="email" id="emailInput" placeholder="email@example.com" />
    <label for="passwordInput">Password</label>
    <input type="password" id="passwordInput" placeholder="password" />
    <button id="btnLogin" class="primary">Login</button>
    <button id="btnSignup" class="primary">Signup</button>
  </section>

  <section id="gameSection" class="hidden">
    <div id="coinsDisplay">Coins: 0</div>

    <section id="packs">
      <h2>Buy Packs</h2>
      <button data-pack="starter" class="primary">Starter Pack (9 players) - 750 Coins</button>
      <button data-pack="standard" class="primary">Standard Pack (3 players) - 250 Coins</button>
      <button data-pack="rare" class="primary">Rare Pack (2 players) - 500 Coins</button>
      <button data-pack="elite" class="primary">Elite Pack (1 player) - 1000 Coins</button>
    </section>

    <section id="collectionSection">
      <h2>Your Collection (Click to select player)</h2>
      <div id="collection" class="flex-row"></div>
    </section>

    <section id="dreamTeamSection">
      <h2>Your Dream Team (Max 11 players)</h2>
      <div id="dreamTeam" class="flex-row"></div>
    </section>

    <button id="btnReplace" class="primary hidden">Replace Selected Team Player with Selected Collection Player</button>
  </section>
</main>

<footer>
  CricBash &copy; 2025 — Made with ❤️
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

  // Firebase config - REPLACE with your own Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBFOIy-AC31RFfqWzxKklhawE7QAm5_D-I",
  authDomain: "cricbash-bab6c.firebaseapp.com",
  projectId: "cricbash-bab6c",
  storageBucket: "cricbash-bab6c.firebasestorage.app",
  messagingSenderId: "361682550397",
  appId: "1:361682550397:web:eac03d09959365e93dfb14",
  measurementId: "G-7GVZGWVFRC"
};

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Player database (use your card data)
  const allPlayers = [
    { id: "JS-01", name: "J Sharma", rating: 82, role: "Wicket Keeper", rarity: "rare" },
    { id: "PD-01", name: "P Dubey", rating: 66, role: "Bowler Leggie", rarity: "standard" },
    { id: "AM-01", name: "A Mishra", rating: 78, role: "Bowler Fast", rarity: "standard" },
    { id: "RG-01", name: "R Gautam", rating: 84, role: "Batsman Opener", rarity: "rare" },
    { id: "SK-01", name: "S Kannan", rating: 88, role: "Batsman All Rounder", rarity: "elite" },
    { id: "RV-01", name: "R Vijay", rating: 92, role: "Batsman Power Hitter", rarity: "elite" },
    { id: "KK-01", name: "K Kapoor", rating: 70, role: "Bowler Spinner", rarity: "standard" },
    { id: "AB-01", name: "A Bhat", rating: 80, role: "Bowler Fast", rarity: "rare" },
    { id: "MK-01", name: "M Kumar", rating: 75, role: "Batsman Middle Order", rarity: "standard" },
    { id: "RS-01", name: "R Sharma", rating: 83, role: "Batsman Middle Order", rarity: "rare" },
    { id: "ST-01", name: "S Thakur", rating: 85, role: "Bowler Fast", rarity: "rare" },
    { id: "VP-01", name: "V Patel", rating: 68, role: "Bowler Leggie", rarity: "standard" },
    { id: "CS-01", name: "C Singh", rating: 90, role: "Batsman All Rounder", rarity: "elite" },
    { id: "RR-01", name: "R Raj", rating: 95, role: "Batsman Captain", rarity: "legendary" },
    { id: "KP-01", name: "K Pandya", rating: 73, role: "Bowler Fast", rarity: "standard" },
    { id: "VK-01", name: "V Kohli", rating: 97, role: "Batsman Opener", rarity: "legendary" },
  ];

  // Packs define how many random players and their costs
  const packs = {
    starter: { cost: 750, count: 9, rarities: ["standard", "rare"] },
    standard: { cost: 250, count: 3, rarities: ["standard", "rare"] },
    rare: { cost: 500, count: 2, rarities: ["rare", "elite"] },
    elite: { cost: 1000, count: 1, rarities: ["elite", "legendary"] },
  };

  // UI Elements
  const authSection = document.getElementById("authSection");
  const gameSection = document.getElementById("gameSection");
  const statusMsg = document.getElementById("statusMsg");
  const coinsDisplay = document.getElementById("coinsDisplay");
  const collectionDiv = document.getElementById("collection");
  const dreamTeamDiv = document.getElementById("dreamTeam");
  const btnLogout = document.getElementById("btnLogout");
  const btnShowLogin = document.getElementById("btnShowLogin");
  const btnReplace = document.getElementById("btnReplace");

  const emailInput = document.getElementById("emailInput");
  const passwordInput = document.getElementById("passwordInput");
  const btnLogin = document.getElementById("btnLogin");
  const btnSignup = document.getElementById("btnSignup");

  // User data
  let currentUser = null;
  let userData = { coins: 0, collection: [], dreamTeam: [] };

  // For replacement feature
  let selectedCollectionPlayerId = null;
  let selectedDreamTeamPlayerId = null;

  // Helper: Show status message
  function showStatus(message, color = "#ffab00") {
    statusMsg.textContent = message;
    statusMsg.style.color = color;
    setTimeout(() => { statusMsg.textContent = ""; }, 3500);
  }

  // Helper: Shuffle an array
  function shuffle(arr) {
    let array = [...arr];
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // Helper: Get random players from allowed rarities for pack
  function getRandomPlayers(packType) {
    const pack = packs[packType];
    const allowedPlayers = allPlayers.filter(p => pack.rarities.includes(p.rarity));
    const shuffled = shuffle(allowedPlayers);
    return shuffled.slice(0, pack.count);
  }

  // Firebase Firestore paths
  function userDocRef(uid) {
    return doc(db, "users", uid);
  }

  // Save user data to Firestore
  async function saveUserData() {
    if (!currentUser) return;
    await setDoc(userDocRef(currentUser.uid), userData);
  }

  // Load user data from Firestore
  async function loadUserData() {
    if (!currentUser) return;
    const docSnap = await getDoc(userDocRef(currentUser.uid));
    if (docSnap.exists()) {
      userData = docSnap.data();
      // Sanity checks
      if (!userData.coins) userData.coins = 1000;
      if (!userData.collection) userData.collection = [];
      if (!userData.dreamTeam) userData.dreamTeam = [];
    } else {
      // First time user
      userData = {
        coins: 1000,
        collection: [],
        dreamTeam: []
      };
      await saveUserData();
    }
  }

  // Render coins display
  function renderCoins() {
    coinsDisplay.textContent = `Coins: ${userData.coins}`;
  }

  // Render collection
  function renderCollection() {
    collectionDiv.innerHTML = "";
    if (userData.collection.length === 0) {
      collectionDiv.textContent = "Your collection is empty. Open packs to get players!";
      return;
    }
    userData.collection.forEach(pId => {
      const p = allPlayers.find(pl => pl.id === pId);
      if (!p) return;
      const card = createPlayerCard(p, false);
      card.addEventListener("click", () => {
        // Select player from collection
        if (selectedCollectionPlayerId === p.id) {
          selectedCollectionPlayerId = null;
          card.classList.remove("selected");
          btnReplace.classList.add("hidden");
        } else {
          selectedCollectionPlayerId = p.id;
          // Deselect all other collection cards
          [...collectionDiv.children].forEach(c => c.classList.remove("selected"));
          card.classList.add("selected");
          // Show replace button only if team player selected too
          if (selectedDreamTeamPlayerId) {
            btnReplace.classList.remove("hidden");
          }
        }
      });
      collectionDiv.appendChild(card);
    });
  }

  // Render dream team
  function renderDreamTeam() {
    dreamTeamDiv.innerHTML = "";
    if (userData.dreamTeam.length === 0) {
      dreamTeamDiv.textContent = "Your dream team is empty. Add players from collection!";
      return;
    }
    userData.dreamTeam.forEach(pId => {
      const p = allPlayers.find(pl => pl.id === pId);
      if (!p) return;
      const card = createPlayerCard(p, true);
      card.addEventListener("click", () => {
        if (selectedDreamTeamPlayerId === p.id) {
          selectedDreamTeamPlayerId = null;
          card.classList.remove("replace-highlight");
          btnReplace.classList.add("hidden");
        } else {
          selectedDreamTeamPlayerId = p.id;
          [...dreamTeamDiv.children].forEach(c => c.classList.remove("replace-highlight"));
          card.classList.add("replace-highlight");
          // Show replace button only if collection player selected too
          if (selectedCollectionPlayerId) {
            btnReplace.classList.remove("hidden");
          }
        }
      });
      dreamTeamDiv.appendChild(card);
    });
  }

  // Create a player card element
  function createPlayerCard(player, isInTeam) {
    const card = document.createElement("div");
    card.className = "card " + (player.rarity || "standard");
    card.innerHTML = `
      <h3>${player.name}</h3>
      <p><strong>Role:</strong> ${player.role}</p>
      <p><strong>Rating:</strong> ${player.rating}</p>
      <small>Rarity: ${player.rarity.charAt(0).toUpperCase() + player.rarity.slice(1)}</small>
      ${isInTeam ? `<button class="btn-small">Remove</button>` : ""}
    `;
    if (isInTeam) {
      card.querySelector("button").addEventListener("click", (e) => {
        e.stopPropagation();
        removeFromDreamTeam(player.id);
      });
    }
    return card;
  }

  // Remove a player from dream team (goes back to collection)
  async function removeFromDreamTeam(playerId) {
    if (!confirm("Remove this player from your Dream Team?")) return;
    userData.dreamTeam = userData.dreamTeam.filter(id => id !== playerId);
    if (!userData.collection.includes(playerId)) {
      userData.collection.push(playerId);
    }
    await saveUserData();
    renderDreamTeam();
    renderCollection();
  }

  // Replace player in dream team with one from collection
  async function replacePlayer() {
    if (!selectedCollectionPlayerId || !selectedDreamTeamPlayerId) return;
    // Remove dream team player, add back to collection
    userData.dreamTeam = userData.dreamTeam.filter(id => id !== selectedDreamTeamPlayerId);
    userData.collection.push(selectedDreamTeamPlayerId);
    // Remove collection player from collection and add to dream team
    userData.collection = userData.collection.filter(id => id !== selectedCollectionPlayerId);
    userData.dreamTeam.push(selectedCollectionPlayerId);
    selectedCollectionPlayerId = null;
    selectedDreamTeamPlayerId = null;
    btnReplace.classList.add("hidden");
    await saveUserData();
    renderCollection();
    renderDreamTeam();
    showStatus("Player replaced in Dream Team!", "#0f0");
  }

  // Buy and open a pack
  async function buyPack(packType) {
    const pack = packs[packType];
    if (userData.coins < pack.cost) {
      showStatus("Not enough coins to buy this pack!", "#f00");
      return;
    }
    userData.coins -= pack.cost;

    // Get random players
    const newPlayers = getRandomPlayers(packType);
    // Add to collection (avoid duplicates)
    newPlayers.forEach(p => {
      if (!userData.collection.includes(p.id) && !userData.dreamTeam.includes(p.id)) {
        userData.collection.push(p.id);
      }
    });

    await saveUserData();
    renderCoins();
    renderCollection();
    showStatus(`Opened ${pack.count} players from ${packType} pack!`, "#0f0");
  }

  // Authentication handlers
  btnLogin.addEventListener("click", async () => {
    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();
    if (!email || !password) {
      showStatus("Please enter email and password.", "#f00");
      return;
    }
    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      currentUser = userCredential.user;
      await loadUserData();
      showGameUI();
      renderCoins();
      renderCollection();
      renderDreamTeam();
      showStatus("Login successful!", "#0f0");
    } catch (error) {
      showStatus(error.message, "#f00");
    }
  });

  btnSignup.addEventListener("click", async () => {
    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();
    if (!email || !password) {
      showStatus("Please enter email and password.", "#f00");
      return;
    }
    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      currentUser = userCredential.user;
      await loadUserData();
      showGameUI();
      renderCoins();
      renderCollection();
      renderDreamTeam();
      showStatus("Signup successful!", "#0f0");
    } catch (error) {
      showStatus(error.message, "#f00");
    }
  });

  btnLogout.addEventListener("click", () => {
    auth.signOut();
    currentUser = null;
    userData = { coins: 0, collection: [], dreamTeam: [] };
    showAuthUI();
    showStatus("Logged out.", "#ffab00");
  });

  // Show game UI after login
  function showGameUI() {
    authSection.classList.add("hidden");
    gameSection.classList.remove("hidden");
  }

  // Show auth UI before login
  function showAuthUI() {
    authSection.classList.remove("hidden");
    gameSection.classList.add("hidden");
  }

  // Initial state
  showAuthUI();

  // Replace button click
  btnReplace.addEventListener("click", replacePlayer);

  // Firebase auth state change
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      currentUser = user;
      await loadUserData();
      showGameUI();
      renderCoins();
      renderCollection();
      renderDreamTeam();
    } else {
      currentUser = null;
      userData = { coins: 0, collection: [], dreamTeam: [] };
      showAuthUI();
    }
  });
})();
</script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #1e1e2f, #121217);
    color: #ddd;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  h1, h2, h3 {
    margin: 0;
    font-weight: 600;
  }

  .hidden {
    display: none;
  }

  #authSection, #gameSection {
    max-width: 900px;
    margin: 2rem auto;
    padding: 2rem;
    background: #222233;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.1);
  }

  #authSection input {
    width: 100%;
    padding: 0.7rem 1rem;
    margin-bottom: 1rem;
    border-radius: 6px;
    border: none;
    outline: none;
    font-size: 1rem;
  }

  #authSection button {
    width: 48%;
    margin: 0 1% 1rem 0;
    padding: 0.7rem 1rem;
    font-weight: 600;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: #0ff;
    color: #121217;
    transition: background-color 0.3s ease;
  }

  #authSection button:hover {
    background: #0cc;
  }

  #statusMsg {
    text-align: center;
    margin-bottom: 1rem;
    min-height: 1.5rem;
    font-weight: 600;
  }

  #coinsDisplay {
    font-size: 1.4rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: #0ff;
  }

  .cards-container {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 2rem;
    justify-content: center;
  }

  .card {
    background: linear-gradient(145deg, #121217, #222233);
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.15);
    width: 170px;
    padding: 1rem;
    cursor: pointer;
    position: relative;
    transition: transform 0.3s ease;
    user-select: none;
  }

  .card:hover {
    transform: translateY(-6px);
  }

  .card.standard {
    border: 2px solid #555;
  }

  .card.rare {
    border: 2px solid #0ff;
  }

  .card.elite {
    border: 2px solid #0a84ff;
  }

  .card.legendary {
    border: 2px solid #fbcf33;
    box-shadow: 0 0 15px #fbcf33;
  }

  .card.selected {
    box-shadow: 0 0 25px #0ff;
  }

  .card.replace-highlight {
    box-shadow: 0 0 25px #fbcf33;
  }

  .btn-small {
    background: #0ff;
    color: #121217;
    border: none;
    border-radius: 6px;
    padding: 0.4rem 0.8rem;
    font-weight: 600;
    cursor: pointer;
    position: absolute;
    bottom: 8px;
    right: 8px;
    transition: background-color 0.3s ease;
  }

  .btn-small:hover {
    background: #0cc;
  }

  #btnReplace {
    background: #fbcf33;
    color: #121217;
    font-weight: 700;
    border-radius: 12px;
    padding: 0.7rem 1.5rem;
    border: none;
    cursor: pointer;
    margin: 0 auto 2rem auto;
    display: block;
    box-shadow: 0 0 15px #fbcf33;
    transition: background-color 0.3s ease;
  }

  #btnReplace:hover {
    background: #d1b927;
  }

  #packs {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 2rem;
  }

  .pack-btn {
    background: #0ff;
    border: none;
    border-radius: 10px;
    padding: 0.8rem 1.4rem;
    font-weight: 700;
    color: #121217;
    cursor: pointer;
    box-shadow: 0 0 15px #0ff;
    transition: background-color 0.3s ease;
  }

  .pack-btn:hover {
    background: #0cc;
  }

  footer {
    margin-top: auto;
    text-align: center;
    padding: 1rem 0;
    color: #444;
    font-size: 0.9rem;
  }

  @media (max-width: 600px) {
    .card {
      width: 140px;
    }

    #authSection, #gameSection {
      margin: 1rem;
      padding: 1rem;
    }

    #authSection button {
      width: 100%;
      margin-bottom: 0.8rem;
    }

    #packs {
      flex-direction: column;
      gap: 10px;
    }
  }
</style>
</body>
</html>

